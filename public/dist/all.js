!function(){angular.module("routes",[]);var e=angular.module("zgApp",["ui.router","ui.bootstrap","routes","ngAnimate","ngSanitize","ngCookies"]);e.config(["$urlRouterProvider","$locationProvider","$httpProvider",function(e,t,n){t.html5Mode(!0),e.otherwise("/home"),n.interceptors.push("interceptFactory")}]),e.run(["$state",function(e){e.go("main.home")}])}(),function(){var e=function(e){e.state("main",{url:"","abstract":!0,templateUrl:"views/layout.html",controller:"mainController as main"}).state("main.home",{url:"/home",templateUrl:"views/homepage.html"}).state("main.login",{url:"/login",templateUrl:"views/login.html"}).state("main.brothers",{url:"/brothers",templateUrl:"views/brothers.html"}).state("main.profile",{url:"/brothers/:brotherid",templateUrl:"views/profile.html",controller:"profileController as brother"}).state("main.admin",{url:"/admin",templateUrl:"views/adminBrothers.html",controller:"adminController as admin"}).state("main.create",{url:"/admin/brothers/create",templateUrl:"views/profile.html",controller:"profileController as brother"}).state("main.edit",{url:"/admin/brothers/:brotherid",templateUrl:"views/profile.html",controller:"profileController as brother"})};e.$inject=["$stateProvider"],angular.module("routes").config(e)}(),function(){var e=function(e,t,n){var r=this;r.startSpinner=function(){r.processing=!0},r.endSpinner=function(){r.processing=!1},r.init=function(){n.get().then(function(e){e.data.success&&(r.brothers=e.data.info),console.log(e.data.message)})},r.init(),r["delete"]=function(e,t){r.startSpinner(),n["delete"](e).then(function(e){console.log(e.data.message)}),n.deletePicture(t).then(function(e){console.log(e.data.message)}),r.init()},r.resetPicture=function(e,t){n.deletePicture(t).then(function(e){console.log(e.data.message)}),r.userData={picture:"0.jpg"},n.update(e,r.userData).then(function(e){console.log(e.data.message),r.init()})},r.setID=function(e){r.desiredID=e}};e.$inject=["$state","$stateParams","crudFactory"],angular.module("zgApp").controller("adminController",e)}(),function(){var e=function(e,t,n,r,a,o,i,s){var u=this;u.loggedIn=r.isLoggedIn(),u.$state=e,u.standings=s.getStandings(),u.availables=s.getAvailables(),u.gpas=s.getGpas(),u.sortType="roll",u.sortReverse=!0,u.filter={},u.startSpinner=function(){u.processing=!0},u.endSpinner=function(){u.processing=!1},n.$on("$stateChangeStart",function(){u.init(),u.loggedIn=r.isLoggedIn(),console.log("Logged in:"+u.loggedIn),u.loggedIn&&o.localStorage.getItem("token")&&r.getUser().then(function(e){e.data.success&&(u.current=e.data.info,console.log("Current logged on user: "+JSON.stringify(e.data.info.username))),console.log(e.data.message)})}),u.init=function(){a.get().then(function(e){e.data.success&&(u.brothers=e.data.info,console.log(e.data.message))})},u.doLogin=function(){u.error="",r.login(u.loginData.username,u.loginData.password).then(function(t){t.data.success?(o.localStorage.setItem("token",t.data.token),e.go("main.brothers")):u.error=t.data.message,console.log(t.data.message)})},u.doLogout=function(){r.logout(),u.current="",u.loggedIn=!1},u.filterByProperties=function(e){var t=!0;for(var n in u.filter)if(!u.noSubFilter(u.filter[n])&&!u.filter[n][e[n]]){t=!1;break}return t},u.noSubFilter=function(e){for(var t in e)if(e[t])return!1;return!0},u.setID=function(e){u.desiredID=e._id},u.init()};e.$inject=["$state","$scope","$rootScope","authFactory","crudFactory","$window","$cookieStore","items"],angular.module("zgApp").controller("mainController",e)}(),function(){var e=function(e,t,n,r,a,o,i){var s=this;s.standings=o.getStandings(),s.availables=o.getAvailables(),s.gpas=o.getGpas(),s.userData={},s.resetMessages=function(){s.dataMessage="",s.pictureMessage=""},s.resetInternships=function(){s.userData.internships=[{id:1,name:""}]},s.startSpinner=function(){s.processing=!0},s.endSpinner=function(){s.processing=!1},s.init=function(){console.log("State: "+t.current.name),s.startSpinner(),s.resetMessages(),"main.create"===t.current.name?(s.userData=o.getDefault(),s.readPicture("0.jpg")):"main.edit"!==t.current.name&&"main.profile"!==t.current.name||s.readBrother(n.brotherid)},s.readBrother=function(e){r.read(e).then(function(e){e.data.success&&(s.userData=e.data.info,s.userData.graduation=new Date(s.userData.graduation),s.readPicture(s.userData.picture)),s.dataMessage=i.setMessages(e)})},s.putBrother=function(){s.resetMessages(),s.startSpinner(),s.spliceArray(s.userData.internships),r.update(n.brotherid,s.userData).then(function(e){e.data.success&&s.uploadPicture(n.brotherid,"PUT"),s.dataMessage=i.setMessages(e)})},s.postBrother=function(){s.startSpinner(),s.resetMessages(),s.spliceArray(s.userData.internships),r.create(s.userData).then(function(e){e.data.success?s.uploadPicture(e.data.brotherId,"POST"):s.endSpinner(),s.dataMessage=i.setMessages(e)})},s.saveBrother=function(){"main.create"===t.current.name?s.postBrother():"main.edit"!==t.current.name&&"main.profile"!==t.current.name||s.putBrother()},s.readPicture=function(t){console.log(t),r.readPicture(t).then(function(t){t.data.success&&(e.image_source="data:image/jpeg;base64, "+t.data.data),s.pictureMessage=i.setMessages(t),s.endSpinner()})},s.uploadPicture=function(n,r){var o=e.myFile||e.currentFile,u="/api/pictures/"+n;a.upload(r,o,u,function(e,n,r,a){var o={};o.data=e,s.pictureMessage=i.setMessages(o),s.endSpinner(),"main.create"===t.current.name&&(s.userData="")})},e.setFile=function(t){e.currentFile=t.files[0];var n=new FileReader;n.onload=function(t){e.image_source=t.target.result,e.$apply()},e.currentFile&&e.currentFile.type.match("image.*")?(console.log("File type OK."),n.readAsDataURL(t.files[0])):console.log("File type not supported.")},s.addNewChoice=function(){var e=s.userData.internships.length;s.userData.internships[e-1].name?s.userData.internships.push({id:e+1,name:""}):console.log("Cannot add more until the last is filled.")},s.removeChoice=function(){var e=s.userData.internships.length;e-1===0?s.resetInternships():s.userData.internships.splice(e-1)},s.spliceArray=function(e){var t=e.length;e[t-1].name||t-1===0||e.splice(t-1)},s.init()};e.$inject=["$scope","$state","$stateParams","crudFactory","fileUpload","items","profile"],angular.module("zgApp").controller("profileController",e)}(),function(){var e=function(e,t,n){var r={login:function(t,n){return e.post("/api/authenticate",{username:t,password:n})},logout:function(){n.localStorage.removeItem("token")},isLoggedIn:function(){return!!n.localStorage.getItem("token")},getUser:function(){return e.get("/api/me")}};return r};e.$inject=["$http","$q","$window"],angular.module("zgApp").factory("authFactory",e)}(),function(){var e=function(e){var t={get:function(){return e.get("/api/brothers/")},read:function(t){return e.get("/api/brothers/"+t)},readPicture:function(t){return e.get("/api/pictures/"+t)},create:function(t){return e.post("/api/brothers/",t)},update:function(t,n){return e.put("/api/brothers/"+t,n)},"delete":function(t){return e["delete"]("/api/brothers/"+t)},deletePicture:function(t){return e["delete"]("/api/pictures/"+t)}};return t};e.$inject=["$http"],angular.module("zgApp").factory("crudFactory",e)}(),function(){var e=function(e,t,n,r){var a={request:function(e){var t=r.localStorage.getItem("token");return t&&(e.headers["x-access-token"]=t),e},responseError:function(e){return 401==e.status&&r.localStorage.removeItem("token"),403==e.status&&(r.localStorage.removeItem("token"),n.get("$state").transitionTo("main.home")),e}};return a};e.$inject=["$location","$q","$injector","$window"],angular.module("zgApp").factory("interceptFactory",e)}(),function(){var e=function(e){return{restrict:"A",link:function(t,n,r){var a=e(r.fileDirective),o=a.assign;n.bind("change",function(){t.$apply(function(){o(t,n[0].files[0])})})}}};e.$inject=["$parse"],angular.module("zgApp").directive("fileDirective",e)}(),function(){var e=function(e){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,n,r){function a(){e.includes(o)||e.is(o)?n.addClass("active"):n.removeClass("active")}var o=r.uiSrefActiveIf;t.$on("$stateChangeSuccess",a),a()}]}};e.$inject=["$state"],angular.module("zgApp").directive("uiSrefActiveIf",e)}(),angular.module("zgApp").service("fileUpload",["$http",function(e){this.upload=function(t,n,r,a){var o=new FormData;o.append("file",n),"POST"===t&&e.post(r,o,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(a).error(a),"PUT"===t&&e.put(r,o,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(a).error(a)}}]),angular.module("zgApp").service("items",[function(){var e=[{property:"standing",value:"Active"},{property:"standing",value:"Alumni"}],t=[{property:"available",value:"Internship"},{property:"available",value:"Full-Time"},{property:"available",value:"Part-Time"},{property:"available",value:"Unavailable"}],n=[{property:"gpa",value:"3.00 - 3.32"},{property:"gpa",value:"3.33 - 3.66"},{property:"gpa",value:"3.67 - 4.00"},{property:"gpa",value:"On Request"}],r={available:"Unavailable",gpa:"On Request",standing:"Active",internships:[{id:1,name:""}]};return{getStandings:function(){return e},getAvailables:function(){return t},getGpas:function(){return n},getDefault:function(){return r}}}]),angular.module("zgApp").service("profile",[function(){return{setMessages:function(e){return e.data.success?console.log("Success:"+e.data.message):console.log("Error:"+e.data.message),e.data.message}}}]);